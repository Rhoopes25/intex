<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Events - Ella Rises</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles.css">
</head>

<body>
    <%- include('partials/navbar') %>

    <!-- Floating Images -->
    <img src="/butterfly.jpg" class="floating-clipart butterfly-1">
    <img src="/flower1.jpg" class="floating-clipart flower-top-right">
    <img src="/flower2.jpg" class="floating-clipart flower-hero-left">
    <img src="/flower3.jpg" class="floating-clipart flower-hero-right">
    <img src="/butterfly.jpg" class="floating-clipart butterfly-2">

    <%
        const today = new Date();
        today.setHours(0,0,0,0);

        // Upcoming events
        let upcomingEvents = events.filter(e => new Date(e.eventdatetimestart) >= today);
        upcomingEvents.sort((a, b) => new Date(a.eventdatetimestart) - new Date(b.eventdatetimestart));

        // Past events
        let pastEvents = events.filter(e => new Date(e.eventdatetimestart) < today);
        pastEvents.sort((a, b) => new Date(b.eventdatetimestart) - new Date(a.eventdatetimestart));
        pastEvents = pastEvents.slice(0, 20);
    %>

    <!-- UPCOMING EVENTS -->
    <div class="page-header">
        <div class="container">
            <h1><i class="fas fa-calendar-alt me-3"></i>Upcoming Events</h1>
            <p>Join us for exciting workshops, mentorship sessions, and leadership opportunities</p>
        </div>
    </div>

    <div class="container mb-5">

        <!-- Search bar -->
        <div class="mb-3">
            <input type="text" id="searchUpcoming" class="form-control" placeholder="Search upcoming events...">
        </div>

        <% if (upcomingEvents.length === 0) { %>
            <div class="text-center py-5">
                <i class="fas fa-calendar-times" style="font-size: 4rem; color: var(--text-light);"></i>
                <h3 class="mt-3">No upcoming events</h3>
                <p>Check back soon for new opportunities!</p>
            </div>
        <% } else { %>
            <div class="row" id="upcomingEventsList">

                <% upcomingEvents.forEach(event => { 
                    const startDate = new Date(event.eventdatetimestart);
                    const regDeadline = event.eventregistrationdeadline ? new Date(event.eventregistrationdeadline) : null;
                    const now = new Date();
                    const showRegister = !regDeadline || regDeadline >= now;
                %>

                <div class="col-md-6 mb-4 event-item-upcoming">
                    <div class="event-card">
                        <div class="row">
                            <div class="col-4">
                                <div class="event-date">
                                    <div class="day"><%= startDate.getDate() %></div>
                                    <div class="month-year">
                                        <%= startDate.toLocaleString('default', { month: 'short' }) %> 
                                        <%= startDate.getFullYear() %>
                                    </div>
                                </div>
                            </div>
                            <div class="col-8 event-content">
                                <h4 class="event-name"><%= event.eventname || event.templatename %></h4>

                                <p class="text-muted mb-1">
                                    <i class="fas fa-clock me-2"></i>
                                    <%= startDate.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }) %>
                                </p>

                                <% if (regDeadline) { %>
                                    <p class="text-muted mb-2">
                                        <i class="fas fa-hourglass-half me-2"></i>
                                        Registration deadline:
                                        <%= regDeadline.toLocaleDateString('en-US') %>
                                        <%= regDeadline.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }) %>
                                    </p>
                                <% } %>

                                <p class="text-muted mb-2 event-location">
                                    <i class="fas fa-map-marker-alt me-2"></i>
                                    <%= event.eventlocation || 'TBA' %>
                                </p>

                                <% if (event.eventdescription) { %>
                                    <p class="event-description"><%= event.eventdescription.substring(0, 100) %></p>
                                <% } %>

                                <% if (showRegister) { %>
                                    <a href="/eventRegister/<%= event.occurrenceid %>?returnTo=/events"
                                        class="btn btn-primary btn-sm">
                                        <i class="fas fa-user-plus me-2"></i>Register
                                    </a>
                                <% } %>

                            </div>
                        </div>
                    </div>
                </div>

                <% }) %>

            </div>
        <% } %>

    </div>




    <!-- PAST EVENTS -->
    <div class="page-header mt-5">
        <div class="container">
            <h1><i class="fas fa-history me-3"></i>Past Events</h1>
            <p>Look back at past workshops, mentorship sessions, and achievements</p>
        </div>
    </div>

    <div class="container mb-5">

        <!-- Search bar -->
        <div class="mb-3">
            <input type="text" id="searchPast" class="form-control" placeholder="Search past events...">
        </div>

        <% if (pastEvents.length === 0) { %>
            <div class="text-center py-5">
                <i class="fas fa-history" style="font-size: 4rem; color: var(--text-light);"></i>
                <h3 class="mt-3">No past events</h3>
            </div>
        <% } else { %>
            <div class="row" id="pastEventsList">

                <% pastEvents.forEach(event => { 
                    const startDate = new Date(event.eventdatetimestart);
                %>

                <div class="col-md-6 mb-4 event-item-past">
                    <div class="event-card">
                        <div class="row">
                            <div class="col-4">
                                <div class="event-date">
                                    <div class="day"><%= startDate.getDate() %></div>
                                    <div class="month-year">
                                        <%= startDate.toLocaleString('default', { month: 'short' }) %> 
                                        <%= startDate.getFullYear() %>
                                    </div>
                                </div>
                            </div>

                            <div class="col-8 event-content">
                                <h4 class="event-name"><%= event.eventname || event.templatename %></h4>

                                <p class="text-muted">
                                    <i class="fas fa-clock me-2"></i>
                                    <%= startDate.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }) %>
                                </p>

                                <p class="text-muted event-location">
                                    <i class="fas fa-map-marker-alt me-2"></i>
                                    <%= event.eventlocation || 'TBA' %>
                                </p>

                                <% if (event.eventdescription) { %>
                                    <p class="event-description"><%= event.eventdescription.substring(0, 100) %></p>
                                <% } %>
                            </div>

                        </div>
                    </div>
                </div>

                <% }) %>

            </div>
        <% } %>

    </div>


    <%- include('partials/footer') %>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // UNIVERSAL SEARCH FUNCTION
        function addSearch(inputId, itemClass) {
            const input = document.getElementById(inputId);

            input.addEventListener("keyup", function () {
                const filter = input.value.toLowerCase();

                document.querySelectorAll(itemClass).forEach(row => {
                    const name = row.querySelector(".event-name")?.textContent.toLowerCase() || "";
                    const location = row.querySelector(".event-location")?.textContent.toLowerCase() || "";
                    const description = row.querySelector(".event-description")?.textContent.toLowerCase() || "";
                    const date = row.querySelector(".month-year")?.textContent.toLowerCase() || "";

                    const show =
                        name.includes(filter) ||
                        location.includes(filter) ||
                        description.includes(filter) ||
                        date.includes(filter);

                    row.style.display = show ? "" : "none";
                });
            });
        }

        addSearch("searchUpcoming", ".event-item-upcoming");
        addSearch("searchPast", ".event-item-past");
    </script>

</body>
</html>
